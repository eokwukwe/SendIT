{"version":3,"sources":["UserController.js"],"names":["UserController","req","res","errors","isEmpty","status","json","array","body","fname","lname","eml","password","hassPassword","Helper","hashPassword","queryText","values","Date","db","query","rows","id","usertype","firstname","lastname","email","payload","token","generateToken","message","details","routine","error","err","comparePassword"],"mappings":"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","file":"UserController.js","sourceRoot":"/home/okwukwe/Desktop/Andela/sendIT/server/controllers","sourcesContent":["import moment from 'moment';\nimport { validationResult } from 'express-validator/check';\n\nimport db from '../model';\nimport Helper from '../helper/helper';\n\n/** Users Controller Class */\nexport default class UserController {\n  /**\n   * @static\n   * @desc POST /api/v1/auth/signup\n   * @param {object} req\n   * @param {object} res\n   * @returns user token\n   * @memberof UserController\n   */\n  static async create(req, res) {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.status(400).json(errors.array());\n    }\n\n    const {\n      fname, lname, eml, password\n    } = req.body;\n    const hassPassword = Helper.hashPassword(password);\n    const queryText = 'INSERT INTO users(firstname, lastname, email, password, created_on, updated_on) VALUES ($1, $2, $3, $4, $5, $6) returning *';\n\n    const values = [fname, lname, eml, hassPassword, moment(new Date()), moment(new Date())];\n\n    try {\n      const { rows } = await db.query(queryText, values);\n      const {\n        id, usertype, firstname, lastname, email\n      } = rows[0];\n      const payload = { id, usertype, email };\n      const token = Helper.generateToken(payload);\n\n      return res.status(201).json({\n        status: 'signup success',\n        message: 'you have successfully signed up',\n        token,\n        details: {\n          firstname,\n          lastname\n        }\n      });\n    } catch (err) {\n      if (err.routine === '_bt_check_unique') {\n        return res.status(400).json({\n          status: 'signup failure',\n          message: 'user with that email already exists'\n        });\n      }\n      return res.status(400).json({\n        status: 'error',\n        error: 'signup unsuccessful',\n        err\n      });\n    }\n  }\n\n  /**\n   * @static\n   * @desc POST /api/v1/auth/login\n   * @param {object} req\n   * @param {object} res\n   * @returns user token\n   * @memberof UserController\n   */\n  static async login(req, res) {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.status(400).json(errors.array());\n    }\n\n    const { email, password } = req.body;\n    const queryText = 'SELECT * FROM users WHERE email = $1';\n\n    try {\n      const { rows } = await db.query(queryText, [email]);\n      if (!rows[0]) {\n        return res.status(400).json({\n          status: 'login failure',\n          message: 'user does not exist'\n        });\n      }\n      if (!Helper.comparePassword(rows[0].password, password)) {\n        return res.status(400).json({\n          status: 'login failure',\n          message: 'incorrect password'\n        });\n      }\n\n      const { id, usertype } = rows[0];\n      const token = Helper.generateToken(id, usertype);\n      return res.status(200).json({\n        status: 'login success',\n        message: 'you have successfully log in',\n        token\n      });\n    } catch (err) {\n      return res.status(400).json({\n        status: 'error',\n        err\n      });\n    }\n  }\n}\n"]}