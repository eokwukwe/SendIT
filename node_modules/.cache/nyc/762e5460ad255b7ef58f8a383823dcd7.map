{"version":3,"sources":["UserController.js"],"names":["UserController","req","res","errors","isEmpty","status","json","array","body","fname","lname","email","password","hassPassword","Helper","hashPassword","queryText","values","Date","db","query","rows","id","usertype","firstname","lastname","token","generateToken","message","details","routine","error","comparePassword"],"mappings":"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","file":"UserController.js","sourceRoot":"/home/okwukwe/Desktop/Andela/sendIT/server/controllers","sourcesContent":["import moment from 'moment';\nimport { validationResult } from 'express-validator/check';\n\nimport db from '../model';\nimport Helper from '../helper/helper';\n\n/** Users Controller Class */\nexport default class UserController {\n  /**\n   * @static\n   * @desc POST /api/v1/auth/signup\n   * @param {object} req\n   * @param {object} res\n   * @returns user token\n   * @memberof User\n   */\n  static async create(req, res) {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.status(400).json(errors.array());\n    }\n\n    const {\n      fname, lname, email, password\n    } = req.body;\n    const hassPassword = Helper.hashPassword(password);\n    const queryText = 'INSERT INTO users(firstname, lastname, email, password, created_on, updated_on) VALUES ($1, $2, $3, $4, $5, $6) returning *';\n\n    const values = [fname, lname, email, hassPassword, moment(new Date()), moment(new Date())];\n\n    try {\n      const { rows } = await db.query(queryText, values);\n      const {\n        id, usertype, firstname, lastname\n      } = rows[0];\n      const token = Helper.generateToken(id, usertype);\n\n      return res.status(201).json({\n        status: 'signup success',\n        message: 'you have successfully signed up',\n        token,\n        details: {\n          firstname,\n          lastname\n        }\n      });\n    } catch (error) {\n      if (error.routine === '_bt_check_unique') {\n        return res.status(400).json({\n          status: 'signup failure',\n          message: 'user with that email already exists'\n        });\n      }\n      return res.status(400).json({\n        status: 'signup failure',\n        message: 'signup unsuccessful',\n        error\n      });\n    }\n  }\n\n  /**\n   * @static\n   * @desc POST /api/v1/auth/login\n   * @param {object} req\n   * @param {object} res\n   * @returns user token\n   * @memberof User\n   */\n  static async login(req, res) {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.status(400).json(errors.array());\n    }\n\n    const { email, password } = req.body;\n    const queryText = 'SELECT * FROM users WHERE email = $1';\n\n    try {\n      const { rows } = await db.query(queryText, [email]);\n      if (!rows[0]) {\n        return res.status(400).json({\n          status: 'login failure',\n          message: 'user does not exist'\n        });\n      }\n      if (!Helper.comparePassword(rows[0].password, password)) {\n        return res.status(400).json({\n          status: 'login failure',\n          message: 'incorrect password'\n        });\n      }\n\n      const { id, usertype } = rows[0];\n      const token = Helper.generateToken(id, usertype);\n      return res.status(200).json({\n        status: 'login success',\n        message: 'you have successfully log in',\n        token\n      });\n    } catch (error) {\n      return res.status(400).json({\n        status: 'login failure',\n        error\n      });\n    }\n  }\n}\n"]}